doctype html
html
  body
    .wrapper
      .sidebar
        h1
          |  福岡県福岡市博多区
        p
          tt
            |  人口&nbsp&nbsp&nbsp&nbsp
          tt
            |  232,795人
        p
          tt
            |  男女比&nbsp&nbsp&nbsp
          tt
            |  5:5
        p
          tt
            |  年齢比
          p
            tt
              |  &nbsp&nbsp10代以下&nbsp&nbsp&nbsp
            tt
              |  11%
          p
            tt
              |  &nbsp&nbsp20代&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
            tt
              |  12%
          p
            tt
              |  &nbsp&nbsp30代&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
            tt
              |  15%
          p
            tt
              |  &nbsp&nbsp40代&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
            tt
              |  17%
          p
            tt
              |  &nbsp&nbsp50代&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
            tt
              |  20%
          p
            tt
              |  &nbsp&nbsp60代以上&nbsp&nbsp&nbsp
            tt
              |  25%
        input style="margin-left: 20px; margin-bottom: 10px; width: 150px;" placeholder='キーワードで絞り込む'
        ul style='list-style: none; color: white; padding: 0; margin-left: 15px; margin-top: 0px;'
          li style="margin-top: 10px;"
            input type='checkbox' style="margin-right: 10px;" 飲食関係(30)
          li style="margin-top: 10px;"
            input type='checkbox' style="margin-right: 10px;" ファッション(21)
          li style="margin-top: 10px;"
            input type='checkbox' style="margin-right: 10px;" エンタメ(18)
          li style="margin-top: 10px;"
            input type='checkbox' style="margin-right: 10px;" 公共施設(12)
          li style="margin-top: 10px;"
            input type='checkbox' style="margin-right: 10px;" 交通関係(8)

          
      .mapview
        - if user_signed_in?
          | 
          #map style="width: 100%; height: 100%;"
            javascript:
              var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 17,
                center: {lat: 33.590324, lng: 130.423942}
                });
                var geocoder = new google.maps.Geocoder();

                document.getElementById('submit').addEventListener('click', function() {
                  geocodeAddress(geocoder, map);
                });

                function geocodeAddress(geocoder, resultsMap) {
                  var address = document.getElementById('address').value;
                  geocoder.geocode({'address': address}, function(results, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                      resultsMap.setCenter(results[0].geometry.location);
                      var marker = new google.maps.Marker({
                      map: resultsMap,
                      position: results[0].geometry.location
                      });
                    } else {
                      alert('Geocode was not successful for the following reason: ' + status);
                    }
                  });
                }

                handler = Gmaps.build('Google');
                handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
                  markers = handler.addMarkers(#{raw @hash.to_json});
                  handler.bounds.extendWith(markers);
                  handler.fitMapToBounds();
                });

                handler.callback = function(){
                  google.maps.event.addListener(handler.map.serviceObject, "click", function(e){
                    console.log(e.latLng.lat(), e.latLng.lng());
                    markers = handler.addMarkers([
                      {
                        "lat": e.latLng.lat(),
                        "lng": e.latLng.lng(),
                        "infowindow": "<input></input><b>が欲しい!</b><br><textarea placeholder='本文'></textarea>",
                      }
                    ]);
                  });
                }();


        - else
               #map style="width: 100%; height: 100%;"
                 javascript:
                   var map = new google.maps.Map(document.getElementById('map'), {
                   zoom: 17,
                   center: {lat: 33.590324, lng: 130.423942}
                   });
                   var geocoder = new google.maps.Geocoder();

                   document.getElementById('submit').addEventListener('click', function() {
                     geocodeAddress(geocoder, map);
                   });

                   function geocodeAddress(geocoder, resultsMap) {
                     var address = document.getElementById('address').value;
                     geocoder.geocode({'address': address}, function(results, status) {
                       if (status === google.maps.GeocoderStatus.OK) {
                         resultsMap.setCenter(results[0].geometry.location);
                         var marker = new google.maps.Marker({
                         map: resultsMap,
                         position: results[0].geometry.location
                         });
                       } else {
                         alert('Geocode was not successful for the following reason: ' + status);
                       }
                     });
                   }

                   handler = Gmaps.build('Google');
                   handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
                     markers = handler.addMarkers(#{raw @hash.to_json});
                     handler.bounds.extendWith(markers);
                     handler.fitMapToBounds();
                   });

                   handler.callback = function(){
                     google.maps.event.addListener(handler.map.serviceObject, "click", function(e){
                       console.log(e.latLng.lat(), e.latLng.lng());
                       markers = handler.addMarkers([
                         {
                           "lat": e.latLng.lat(),
                           "lng": e.latLng.lng(),
                           "infowindow": 'ピンを建てるには'+'<a href="/users/sign_in">ログイン</a>'+'か'+'<a href="/users/sign_up">新規登録</a>'+'を行ってください',
                         }
                       ]);
                     });
                   }();
